# English News Reader - 設計ドキュメント

## コンセプト

URLを貼るだけで英語ニュース記事を快適に読める、個人学習用Webアプリ（PWA）

「長い」「難しい」という英語ニュースの壁を、単語・文単位のサポートで解消する。

## 解決する課題

- 知らない単語が多すぎて、調べるうちに疲れる
- 文章が長くて、途中で何の話か分からなくなる

## 主な機能

- URL入力で記事を取得・整形表示
- 単語タップ: 文脈に応じた意味をボトムパネルに表示
- 文タップ（長押し）: 日本語訳をボトムパネルに表示
- テキスト直接貼り付け対応（フォールバック）

## 技術スタック

- Frontend: Vanilla JS + Vite
- Backend: Cloudflare Pages Functions
- AI: Gemini 2.0/2.5 Flash
- 本文抽出: Readability.js
- 認証/DB: なし

## アーキテクチャ

```
[ユーザー]
    ↓ URL入力
[フロントエンド (Vite + Vanilla JS)]
    ↓ API呼び出し
[Cloudflare Workers]
    ├─→ 記事取得・パース（HTMLから本文抽出）
    └─→ Gemini API（単語意味・文翻訳）
    ↓
[フロントエンド]
    └─→ 記事表示、タップ操作でボトムパネル表示
```

## 画面構成

2画面のみ:

1. ホーム画面: URL入力欄 + 「読む」ボタン
2. リーダー画面: 記事本文表示

```
┌─────────────────────────┐
│ ← 戻る    記事タイトル    │ ヘッダー
├─────────────────────────┤
│                         │
│  Article text here.     │
│  Each sentence is       │
│  tappable.              │
│                         │
├─────────────────────────┤
│  [単語/文の意味・訳]     │ ボトムパネル
└─────────────────────────┘
```

## タップ操作の設計

- 単語タップ: ボトムパネルに意味表示（品詞、意味、例文）
- 文タップ（長押し0.3秒）: ボトムパネルに日本語訳表示
- パネル外タップ: パネルを閉じる
- 基本単語（a, the, inなど約100語）: タップ対象外

高速化の工夫:
- プリフェッチ: 記事読み込み時に難単語の意味を先に取得
- ローカルキャッシュ: 一度調べた単語はセッション中は即表示
- タップ時は即座にハイライト（50ms以内）、API応答待ちはローディング表示

## API設計

### 記事取得: GET /api/article

```
入力: { url: "https://..." }
出力: {
  "title": "記事タイトル",
  "source": "bbc.com",
  "paragraphs": [
    {
      "sentences": [
        { "text": "This is a sentence.", "words": ["This", "is", "a", "sentence"] }
      ]
    }
  ]
}
```

### 単語の意味: POST /api/word

```
入力: { word: "consolidate", context: "The company will consolidate its operations." }
出力: { meaning: "統合する、一本化する", pos: "動詞", example: "..." }
```

### 文の翻訳: POST /api/translate

```
入力: { sentence: "The company will consolidate its operations." }
出力: { translation: "その会社は事業を統合する予定だ。" }
```

## イタズラ防止策

- IPベースのレート制限（Cloudflare Workers KV）
  - 1時間あたり30記事取得、100回の翻訳リクエスト
- 入力バリデーション: URL形式チェック
- 文字数制限: 1記事あたり最大10,000文字

## エラーハンドリング

| エラー | ユーザーへの表示 |
|--------|------------------|
| URL形式が不正 | 「正しいURLを入力してください」 |
| 記事取得失敗 | 「記事を取得できませんでした」+ テキスト貼り付け欄表示 |
| Gemini API失敗 | 「翻訳を取得できませんでした。再度タップしてください」 |
| レート制限超過 | 「利用上限に達しました。しばらくお待ちください」 |
| ネットワークエラー | 「接続できません。ネットワークを確認してください」 |

## 制約と割り切り

- 認証なし、履歴保存なし（シンプル優先）
- JS多用サイト、有料記事は非対応
- 商用利用なし、個人学習目的
- 記事データは保存しない（著作権配慮）
- 元記事へのリンクを常に表示

## 関連プロジェクト

- [[No33_English_Speaking_Narrative]]: kaku（英語日記生成アプリ）と同じ技術スタック

## ステータス

- 作成日: 2026-01-15
- ステータス: 設計完了、実装待ち
